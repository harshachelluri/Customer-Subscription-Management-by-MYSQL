# Customer Subscription Management System

## Overview

This system helps manage customer subscriptions and payments for a subscription-based business model. It enables tracking of subscription plans, monitoring of payments, and provides analytical insights to maximize revenue, customer retention, and identify trends that influence decision-making.

---

## Business Problem

In a subscription-based business model, managing customers, their subscriptions, and payments is critical for tracking business performance, optimizing revenue, and improving customer satisfaction. The key challenges include:

1. **Understanding Customer Behavior**: Identifying which customers are on which subscription plans, how much they pay, and their likelihood to renew or leave.
2. **Optimizing Subscription Plans**: Analyzing which plans are most popular, most profitable, and understanding trends to optimize offerings.
3. **Revenue Tracking**: Monitoring payments and calculating total revenue per customer, identifying at-risk customers.
4. **Payment Management**: Tracking overdue or pending payments and ensuring timely collection.
5. **Customer Retention**: Identifying high-value customers and ensuring they are satisfied and likely to continue their subscriptions.

---

## Key SQL Queries

These SQL queries address the key challenges outlined above by providing insights into subscription tracking, payment monitoring, and customer segmentation.

---

### 1. **List all customers with their subscription plan details**

```sql
SELECT c.name, c.contact, s.plan_type, s.start_date, s.end_date    
FROM Customers c            
JOIN Subscriptions s ON c.customer_id = s.customer_id;
```

**Purpose**: Retrieves customer names, contact details, subscription plans, and their start/end dates.

---

### 2. **Find the total number of customers who have chosen the "Premium Plan"**

```sql
SELECT COUNT(*) AS premium_customers    
FROM Subscriptions    
WHERE plan_type = 'Premium Plan';
```

**Purpose**: Counts the total number of customers subscribed to the "Premium Plan."

---

### 3. **Get the names of customers who have made a payment of more than $50**

```sql
SELECT c.name, p.amount    
FROM Customers c    
JOIN Payments p ON c.customer_id = p.customer_id    
WHERE p.amount > 50;
```

**Purpose**: Retrieves customers who have made payments greater than $50.

---

### 4. **List all customers who have payments pending in 2024 (payments not made in the current year)**

```sql
SELECT c.name, p.payment_date    
FROM Customers c    
JOIN Payments p ON c.customer_id = p.customer_id    
WHERE YEAR(p.payment_date) < 2024;
```

**Purpose**: Finds customers who have not made any payments in 2024.

---

### 5. **Get the total revenue generated from the "Family Plan" for the year 2024**

```sql
SELECT SUM(p.amount) AS total_revenue    
FROM Payments p    
JOIN Subscriptions s ON p.customer_id = s.customer_id    
WHERE s.plan_type = 'Family Plan'    
AND YEAR(p.payment_date) = 2024;
```

**Purpose**: Calculates the total revenue generated by customers subscribed to the "Family Plan" in 2024.

---

### 6. **Find customers who have subscriptions that will expire within the next 30 days**

```sql
SELECT c.name, s.end_date    
FROM Customers c    
JOIN Subscriptions s ON c.customer_id = s.customer_id    
WHERE s.end_date BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 30 DAY);
```

**Purpose**: Identifies customers whose subscriptions are about to expire in the next 30 days.

---

### 7. **Show the total payments received by each customer in 2024**

```sql
SELECT c.name, SUM(p.amount) AS total_payment    
FROM Customers c    
JOIN Payments p ON c.customer_id = p.customer_id    
WHERE YEAR(p.payment_date) = 2024    
GROUP BY c.name;
```

**Purpose**: Displays the total payment received from each customer in 2024.

---

### 8. **Find customers who have made payments for both "Basic Plan" and "Premium Plan" in 2024**

```sql
SELECT c.name    
FROM Customers c    
JOIN Subscriptions s ON c.customer_id = s.customer_id    
JOIN Payments p ON c.customer_id = p.customer_id    
WHERE (s.plan_type = 'Basic Plan' OR s.plan_type = 'Premium Plan')    
AND YEAR(p.payment_date) = 2024    
GROUP BY c.customer_id    
HAVING COUNT(DISTINCT s.plan_type) = 2;
```

**Purpose**: Identifies customers who have paid for both "Basic Plan" and "Premium Plan" in 2024.

---

### 9. **Get a list of all customers who have not made any payments yet**

```sql
SELECT c.name    
FROM Customers c    
LEFT JOIN Payments p ON c.customer_id = p.customer_id    
WHERE p.payment_id IS NULL;
```

**Purpose**: Lists customers who have not made any payments.

---

### 10. **Find the most popular subscription plan (the one with the highest number of subscribers)**

```sql
SELECT plan_type, COUNT(*) AS subscriber_count    
FROM Subscriptions    
GROUP BY plan_type    
ORDER BY subscriber_count DESC    
LIMIT 1;
```

**Purpose**: Identifies the most popular subscription plan based on the highest number of subscribers.

---

### 11. **Find all customers who have paid more than the average amount paid by all customers**

```sql
SELECT c.name, SUM(p.amount) AS total_paid    
FROM Customers c    
JOIN Payments p ON c.customer_id = p.customer_id    
GROUP BY c.customer_id    
HAVING SUM(p.amount) > (SELECT AVG(amount) FROM Payments);
```

**Purpose**: Retrieves customers who have paid more than the average payment across all customers.

---

### 12. **Calculate the running total of payments for each customer, ordered by payment date**

```sql
SELECT c.name, p.payment_date, p.amount,    
SUM(p.amount) OVER (PARTITION BY c.customer_id ORDER BY p.payment_date) AS running_total    
FROM Customers c    
JOIN Payments p ON c.customer_id = p.customer_id    
ORDER BY c.customer_id, p.payment_date;
```

**Purpose**: Computes the running total of payments for each customer, ordered by payment date.

---

### 13. **Find the total payment amount for each customer, excluding those who have made no payments**

```sql
WITH TotalPayments AS (    
    SELECT c.customer_id, c.name, SUM(p.amount) AS total_paid    
    FROM Customers c    
    LEFT JOIN Payments p ON c.customer_id = p.customer_id        
    GROUP BY c.customer_id, c.name    
)    
SELECT name, total_paid    
FROM TotalPayments    
WHERE total_paid > 0    
ORDER BY total_paid DESC;
```

**Purpose**: Calculates the total payment for customers who have made at least one payment, excluding those who haven't made any payments.

---

### 14. **Rank customers based on their total payments, showing their total payment and rank**

```sql
WITH CustomerTotalPayments AS (    
    SELECT c.customer_id, c.name, SUM(p.amount) AS total_paid    
    FROM Customers c    
    LEFT JOIN Payments p ON c.customer_id = p.customer_id    
    GROUP BY c.customer_id, c.name    
)    
SELECT name, total_paid,    
RANK() OVER (ORDER BY total_paid DESC) AS payment_rank    
FROM CustomerTotalPayments    
WHERE total_paid > 0    
ORDER BY payment_rank;
```

**Purpose**: Ranks customers based on their total payments, from highest to lowest.

---

### 15. **Create a reusable query to list customers subscribed to a "Premium Plan" with their total payments**

```sql
-- Create a view to represent the list of premium customers with their total payments    
CREATE VIEW PremiumCustomers AS    
SELECT c.customer_id, c.name, SUM(p.amount) AS total_paid    
FROM Customers c    
JOIN Payments p ON c.customer_id = p.customer_id    
JOIN Subscriptions s ON c.customer_id = s.customer_id    
WHERE s.plan = 'Premium'    
GROUP BY c.customer_id, c.name;    

-- Query from the view    
SELECT customer_id, name, total_paid    
FROM PremiumCustomers;
```

## Conclusion

These SQL queries and the corresponding **PremiumCustomers** view enable a comprehensive approach to managing customer subscriptions and payments. By leveraging these queries, businesses can:

- Track customer subscriptions and payments efficiently.
- Monitor trends in revenue and customer engagement.
- Identify high-value customers and at-risk customers.


